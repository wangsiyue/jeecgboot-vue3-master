{
  "version": 3,
  "sources": ["../../@jeecg/online/OnlineCustomModal.js"],
  "sourcesContent": ["var __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\nimport { defineComponent, ref, nextTick, watch, reactive, markRaw, defineAsyncComponent, resolveComponent, openBlock, createBlock, mergeProps, withCtx, createVNode, resolveDynamicComponent, createTextVNode } from \"vue\";\nimport { BasicModal, useModalInner } from \"/@/components/Modal\";\nimport { g as getRefPromise } from \"./useAutoForm.js\";\nimport { defHttp } from \"/@/utils/http/axios\";\nimport { O as OnlineForm } from \"./OnlineForm.js\";\nimport { _ as _export_sfc } from \"./index.js\";\nimport \"./FormSchemaFactory.js\";\nimport \"/@/components/Form/src/jeecg/components/JUpload\";\nimport \"/@/views/system/user/user.api\";\nimport \"/@/store/modules/user\";\nimport \"/@/utils\";\nimport \"/@/utils/desform/customExpression\";\nimport \"/@/components/Form/src/componentMap\";\nimport \"./OnlineSelectCascade.js\";\nimport \"/@/hooks/web/useMessage\";\nimport \"/@/components/jeecg/OnLine/JPopupOnlReport.vue\";\nimport \"vue-router\";\nimport \"/@/components/Form/index\";\nimport \"/@/components/Loading\";\nimport \"./OnlineSubForm.js\";\nimport \"./pick.js\";\nimport \"./isArray.js\";\nimport \"./toString.js\";\nimport \"./_arrayPush.js\";\nconst DEF_CONFIG = {\n  code: \"\",\n  title: \"\\u81EA\\u5B9A\\u4E49\\u5F39\\u6846\",\n  width: 600,\n  row: {},\n  hide: [],\n  show: [],\n  requestUrl: \"\",\n  tableType: \"\",\n  foreignKeys: \"\",\n  formComponent: \"\"\n};\nconst _sfc_main = defineComponent({\n  name: \"OnlineCustomModal\",\n  components: {\n    OnlineForm,\n    BasicModal\n  },\n  setup(_props, { emit }) {\n    const onlineFormCompRef = ref();\n    const id = ref(\"\");\n    const title = ref(\"\\u81EA\\u5B9A\\u4E49\\u5F39\\u6846\");\n    const width = ref(600);\n    let onlineHideFields = [];\n    let onlineShowFields = [];\n    let onlineFormEditUrl = \"\";\n    let currentRowData = {};\n    const url = {\n      loadFormItems: \"/online/cgform/api/getFormItem/\",\n      optPre: \"/online/cgform/api/form/\"\n    };\n    const modalStyle = { \"position\": \"relative\" };\n    const confirmLoading = ref(false);\n    const formRendered = ref(false);\n    function renderSuccess() {\n      formRendered.value = true;\n    }\n    const isOnlineForm = ref(true);\n    const [registerModal, { setModalProps, closeModal }] = useModalInner((params) => __async(this, null, function* () {\n      setModalProps({ confirmLoading: false });\n      resetParams(params);\n      yield nextTick(() => __async(this, null, function* () {\n        if (!params.formComponent) {\n          yield showOnlineForm();\n        } else {\n          showCustomForm(params.formComponent);\n        }\n      }));\n    }));\n    function resetParams(params) {\n      let options = Object.assign({}, DEF_CONFIG, params);\n      id.value = options.code;\n      title.value = options.title;\n      width.value = options.width;\n      onlineHideFields = options.hide || [];\n      onlineShowFields = options.show || [];\n      onlineFormEditUrl = getOnlineFormEditUrl(options.requestUrl);\n      currentRowData = options.row;\n    }\n    function getOnlineFormEditUrl(requestUrl) {\n      if (requestUrl) {\n        return requestUrl;\n      } else {\n        return url.optPre + id.value;\n      }\n    }\n    const submitLoading = ref(false);\n    function handleSubmit() {\n      submitLoading.value = true;\n      if (isOnlineForm.value === true) {\n        onlineFormCompRef.value.handleSubmit();\n      } else {\n        customFormRef.value.handleSubmit();\n      }\n      setTimeout(() => {\n        submitLoading.value = true;\n      }, 3500);\n    }\n    function handleCancel() {\n      closeModal();\n    }\n    function handleSuccess(formData) {\n      emit(\"success\", formData);\n      closeModal();\n    }\n    function showOnlineForm() {\n      return __async(this, null, function* () {\n        isOnlineForm.value = true;\n        yield getRefPromise(formRendered);\n        onlineFormCompRef.value.handleCustomFormSh(onlineShowFields, onlineHideFields);\n        onlineFormCompRef.value.handleCustomFormEdit(currentRowData, onlineFormEditUrl);\n      });\n    }\n    const formTemplate = ref(1);\n    watch(id, renderFormItems, { immediate: true });\n    function renderFormItems() {\n      return __async(this, null, function* () {\n        formRendered.value = false;\n        if (!id.value) {\n          return;\n        }\n        console.log(\"\\u91CD\\u65B0\\u6E32\\u67D3\\u8868\\u5355\\u300B\\u300B\\u300B\\u300Bmodal\");\n        let result = yield loadFormItems();\n        let dataFormTemplate = result.head.formTemplate;\n        formTemplate.value = dataFormTemplate ? Number(dataFormTemplate) : 1;\n        nextTick(() => __async(this, null, function* () {\n          let myForm = yield getRefPromise(onlineFormCompRef);\n          myForm.createRootProperties(result);\n        }));\n      });\n    }\n    function loadFormItems() {\n      let url2 = `/online/cgform/api/getFormItem/${id.value}`;\n      return new Promise((resolve, reject) => {\n        defHttp.get({ url: url2 }, { isTransformResponse: false }).then((res) => {\n          console.log(\"\\u8868\\u5355\\u7ED3\\u679C\\u300B\\u300Bmodal:\", res);\n          if (res.success) {\n            resolve(res.result);\n          } else {\n            reject(res.message);\n          }\n        }).catch(() => {\n          reject();\n        });\n      });\n    }\n    const customFormRef = ref();\n    const customFormComponent = reactive({\n      url: \"\",\n      is: \"\",\n      row: {}\n    });\n    function showCustomForm(formComponent) {\n      isOnlineForm.value = false;\n      customFormComponent.url = onlineFormEditUrl;\n      customFormComponent.row = currentRowData;\n      customFormComponent.is = markRaw(defineAsyncComponent(() => import(\n        /* @vite-ignore */\n        \"/@/views/\" + formComponent\n      )));\n    }\n    return {\n      registerModal,\n      title,\n      width,\n      modalStyle,\n      handleSubmit,\n      handleCancel,\n      id,\n      onlineFormCompRef,\n      formTemplate,\n      renderSuccess,\n      customFormRef,\n      customFormComponent,\n      open,\n      isOnlineForm,\n      confirmLoading,\n      submitLoading,\n      handleSuccess\n    };\n  }\n});\nconst _hoisted_1 = /* @__PURE__ */ createTextVNode(\"\\u786E\\u5B9A\");\nconst _hoisted_2 = /* @__PURE__ */ createTextVNode(\"\\u5173\\u95ED\");\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_button = resolveComponent(\"a-button\");\n  const _component_online_form = resolveComponent(\"online-form\");\n  const _component_a_spin = resolveComponent(\"a-spin\");\n  const _component_BasicModal = resolveComponent(\"BasicModal\");\n  return openBlock(), createBlock(_component_BasicModal, mergeProps({\n    title: _ctx.title,\n    width: _ctx.width\n  }, _ctx.$attrs, {\n    style: _ctx.modalStyle,\n    onRegister: _ctx.registerModal,\n    wrapClassName: \"jeecg-online-modal\",\n    onOk: _ctx.handleSubmit\n  }), {\n    footer: withCtx(() => [\n      createVNode(_component_a_button, {\n        key: \"submit\",\n        type: \"primary\",\n        onClick: _ctx.handleSubmit\n      }, {\n        default: withCtx(() => [\n          _hoisted_1\n        ]),\n        _: 1\n      }, 8, [\"onClick\"]),\n      createVNode(_component_a_button, {\n        key: \"back\",\n        onClick: _ctx.handleCancel\n      }, {\n        default: withCtx(() => [\n          _hoisted_2\n        ]),\n        _: 1\n      }, 8, [\"onClick\"])\n    ]),\n    default: withCtx(() => [\n      createVNode(_component_a_spin, { spinning: _ctx.confirmLoading }, {\n        default: withCtx(() => [\n          _ctx.isOnlineForm ? (openBlock(), createBlock(_component_online_form, {\n            key: 0,\n            ref: \"onlineFormCompRef\",\n            id: _ctx.id,\n            \"form-template\": _ctx.formTemplate,\n            onRendered: _ctx.renderSuccess,\n            onSuccess: _ctx.handleSuccess\n          }, null, 8, [\"id\", \"form-template\", \"onRendered\", \"onSuccess\"])) : (openBlock(), createBlock(resolveDynamicComponent(_ctx.customFormComponent.is), {\n            key: 1,\n            ref: \"customFormRef\",\n            url: _ctx.customFormComponent.url,\n            row: _ctx.customFormComponent.row,\n            onClose: _ctx.handleSuccess\n          }, null, 40, [\"url\", \"row\", \"onClose\"]))\n        ]),\n        _: 1\n      }, 8, [\"spinning\"])\n    ]),\n    _: 1\n  }, 16, [\"title\", \"width\", \"style\", \"onRegister\", \"onOk\"]);\n}\nvar OnlineCustomModal = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\nexport { OnlineCustomModal as default };\n"],
  "mappings": "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",
  "names": []
}
