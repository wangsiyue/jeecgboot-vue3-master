{
  "version": 3,
  "sources": ["../../@jeecg/online/OnlineAutoModal.js"],
  "sourcesContent": ["var __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\nimport { defineComponent, ref, computed, unref, nextTick, watch, reactive, resolveComponent, openBlock, createBlock, mergeProps, withCtx, createElementBlock, Fragment, renderList, createTextVNode, toDisplayString, createCommentVNode, createVNode } from \"vue\";\nimport { BasicModal, useModalInner } from \"/@/components/Modal\";\nimport { defHttp } from \"/@/utils/http/axios\";\nimport { g as getRefPromise } from \"./useAutoForm.js\";\nimport { O as OnlineForm } from \"./OnlineForm.js\";\nimport { _ as _export_sfc } from \"./index.js\";\nimport \"./FormSchemaFactory.js\";\nimport \"/@/components/Form/src/jeecg/components/JUpload\";\nimport \"/@/views/system/user/user.api\";\nimport \"/@/store/modules/user\";\nimport \"/@/utils\";\nimport \"/@/utils/desform/customExpression\";\nimport \"/@/components/Form/src/componentMap\";\nimport \"./OnlineSelectCascade.js\";\nimport \"/@/hooks/web/useMessage\";\nimport \"/@/components/jeecg/OnLine/JPopupOnlReport.vue\";\nimport \"vue-router\";\nimport \"/@/components/Form/index\";\nimport \"/@/components/Loading\";\nimport \"./OnlineSubForm.js\";\nimport \"./pick.js\";\nimport \"./isArray.js\";\nimport \"./toString.js\";\nimport \"./_arrayPush.js\";\nconst singleWidth = 800;\nconst one2ManyWidth = 1100;\nconst _sfc_main = defineComponent({\n  name: \"OnlineModal\",\n  props: {\n    id: {\n      type: String,\n      default: \"\"\n    }\n  },\n  components: {\n    BasicModal,\n    OnlineForm\n  },\n  emits: [\"success\", \"register\"],\n  setup(props, { emit }) {\n    console.log(\"\\u8FDB\\u5165\\u8868\\u5355\\u5F39\\u6846\\u300B\\u300B\\u300B\\u300Bmodal\");\n    const onlineFormCompRef = ref(null);\n    const disableSubmit = ref(false);\n    const formTemplate = ref(1);\n    const cgButtonList = ref([]);\n    const formRendered = ref(false);\n    const modalMinWidth = ref(0);\n    const isTreeForm = ref(false);\n    const pidFieldName = ref(\"\");\n    const submitLoading = ref(false);\n    const title = computed(() => {\n      if (unref(disableSubmit) === true) {\n        return \"\\u8BE6\\u60C5\";\n      }\n      if (unref(isUpdate) === true) {\n        return \"\\u7F16\\u8F91\";\n      }\n      return \"\\u65B0\\u589E\";\n    });\n    const [registerModal, { setModalProps, closeModal }] = useModalInner((data) => __async(this, null, function* () {\n      setModalProps({ confirmLoading: false });\n      isUpdate.value = data.isUpdate;\n      disableSubmit.value = data.disableSubmit || false;\n      yield nextTick(() => __async(this, null, function* () {\n        yield getRefPromise(formRendered);\n        yield onlineFormCompRef.value.show(data == null ? void 0 : data.isUpdate, data == null ? void 0 : data.record, data == null ? void 0 : data.param);\n      }));\n    }));\n    function renderSuccess(extConfig) {\n      formRendered.value = true;\n      modalMinWidth.value = extConfig.modalMinWidth;\n      if (extConfig.modelFullscreen == 1) {\n        setModalProps({ defaultFullscreen: true });\n      } else {\n        setModalProps({ defaultFullscreen: false });\n      }\n    }\n    watch(() => props.id, renderFormItems, { immediate: true });\n    function renderFormItems() {\n      return __async(this, null, function* () {\n        formRendered.value = false;\n        if (!props.id) {\n          return;\n        }\n        console.log(\"\\u91CD\\u65B0\\u6E32\\u67D3\\u8868\\u5355\\u300B\\u300B\\u300B\\u300Bmodal\");\n        let result = yield loadFormItems();\n        let dataFormTemplate = result.head.formTemplate;\n        formTemplate.value = dataFormTemplate ? Number(dataFormTemplate) : 1;\n        cgButtonList.value = result.cgButtonList;\n        isTreeForm.value = result.head.isTree === \"Y\";\n        pidFieldName.value = result.head.treeParentIdField || \"\";\n        nextTick(() => __async(this, null, function* () {\n          let myForm = yield getRefPromise(onlineFormCompRef);\n          myForm.createRootProperties(result);\n        }));\n      });\n    }\n    function loadFormItems() {\n      let url = `/online/cgform/api/getFormItem/${props.id}`;\n      return new Promise((resolve, reject) => {\n        defHttp.get({ url }, { isTransformResponse: false }).then((res) => {\n          console.log(\"\\u8868\\u5355\\u7ED3\\u679C\\u300B\\u300Bmodal:\", res);\n          if (res.success) {\n            resolve(res.result);\n          } else {\n            reject(res.message);\n          }\n        }).catch(() => {\n          reject();\n        });\n      });\n    }\n    const modalWidth = computed(() => {\n      let diff = 200 * (formTemplate.value - 1);\n      let width = (!unref(single) ? one2ManyWidth : singleWidth) + diff;\n      width = calcModalMixWidth(width);\n      let minWidth = modalMinWidth.value;\n      console.log({ minWidth });\n      if (minWidth && width < minWidth) {\n        width = minWidth;\n      }\n      console.log({ width });\n      return width;\n    });\n    function calcModalMixWidth(width) {\n      let minWidth = extConfigJson.modalMinWidth;\n      if (minWidth != null && minWidth !== \"\") {\n        try {\n          minWidth = Number.parseInt(minWidth);\n          if (width < minWidth) {\n            return minWidth;\n          }\n        } catch (e) {\n          console.warn(\"error modalMinWidth value: \", minWidth);\n        }\n      }\n      return width;\n    }\n    const isUpdate = ref(false);\n    const single = ref(true);\n    const extConfigJson = reactive({});\n    function handleCgButtonClick(optType, buttonCode) {\n      onlineFormCompRef.value.handleCgButtonClick(optType, buttonCode);\n    }\n    function handleSubmit() {\n      submitLoading.value = true;\n      setTimeout(() => {\n        submitLoading.value = false;\n      }, 1500);\n      onlineFormCompRef.value.handleSubmit();\n    }\n    function handleCancel() {\n      closeModal();\n    }\n    function handleSuccess(formData) {\n      emit(\"success\", formData);\n      closeModal();\n    }\n    const that = {\n      title,\n      onlineFormCompRef,\n      formRendered,\n      renderSuccess,\n      registerModal,\n      handleSubmit,\n      handleSuccess,\n      handleCancel,\n      modalWidth,\n      formTemplate,\n      disableSubmit,\n      cgButtonList,\n      handleCgButtonClick,\n      isTreeForm,\n      pidFieldName,\n      submitLoading\n    };\n    return that;\n  }\n});\nconst _hoisted_1 = /* @__PURE__ */ createTextVNode(\"\\u786E\\u5B9A\");\nconst _hoisted_2 = /* @__PURE__ */ createTextVNode(\"\\u5173\\u95ED\");\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_button = resolveComponent(\"a-button\");\n  const _component_online_form = resolveComponent(\"online-form\");\n  const _component_BasicModal = resolveComponent(\"BasicModal\");\n  return openBlock(), createBlock(_component_BasicModal, mergeProps({\n    title: _ctx.title,\n    width: _ctx.modalWidth\n  }, _ctx.$attrs, {\n    onRegister: _ctx.registerModal,\n    wrapClassName: \"jeecg-online-modal\",\n    onOk: _ctx.handleSubmit\n  }), {\n    footer: withCtx(() => [\n      (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.cgButtonList, (btn) => {\n        return openBlock(), createBlock(_component_a_button, {\n          key: btn.id,\n          type: \"primary\",\n          onClick: ($event) => _ctx.handleCgButtonClick(btn.optType, btn.buttonCode),\n          preIcon: btn.buttonIcon ? \"ant-design:\" + btn.buttonIcon : \"\"\n        }, {\n          default: withCtx(() => [\n            createTextVNode(toDisplayString(btn.buttonName), 1)\n          ]),\n          _: 2\n        }, 1032, [\"onClick\", \"preIcon\"]);\n      }), 128)),\n      !_ctx.disableSubmit ? (openBlock(), createBlock(_component_a_button, {\n        key: \"submit\",\n        type: \"primary\",\n        onClick: _ctx.handleSubmit,\n        loading: _ctx.submitLoading\n      }, {\n        default: withCtx(() => [\n          _hoisted_1\n        ]),\n        _: 1\n      }, 8, [\"onClick\", \"loading\"])) : createCommentVNode(\"\", true),\n      createVNode(_component_a_button, {\n        key: \"back\",\n        onClick: _ctx.handleCancel\n      }, {\n        default: withCtx(() => [\n          _hoisted_2\n        ]),\n        _: 1\n      }, 8, [\"onClick\"])\n    ]),\n    default: withCtx(() => [\n      createVNode(_component_online_form, {\n        ref: \"onlineFormCompRef\",\n        id: _ctx.id,\n        disabled: _ctx.disableSubmit,\n        \"form-template\": _ctx.formTemplate,\n        isTree: _ctx.isTreeForm,\n        pidField: _ctx.pidFieldName,\n        onRendered: _ctx.renderSuccess,\n        onSuccess: _ctx.handleSuccess\n      }, null, 8, [\"id\", \"disabled\", \"form-template\", \"isTree\", \"pidField\", \"onRendered\", \"onSuccess\"])\n    ]),\n    _: 1\n  }, 16, [\"title\", \"width\", \"onRegister\", \"onOk\"]);\n}\nvar OnlineAutoModal = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\nexport { OnlineAutoModal as default };\n"],
  "mappings": "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",
  "names": []
}
