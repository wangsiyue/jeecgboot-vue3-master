{
  "version": 3,
  "sources": ["../../@jeecg/online/OnlineSubForm.js", "../../../src/components/Loading/index.ts", "../../../src/components/Loading/src/useLoading.ts", "../../../src/components/Loading/src/createLoading.ts"],
  "sourcesContent": ["var __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\nimport { useMessage } from \"/@/hooks/web/useMessage\";\nimport { ref, watch, resolveComponent, openBlock, createBlock, unref, toRaw } from \"vue\";\nimport { BasicForm, useForm } from \"/@/components/Form/index\";\nimport { defHttp } from \"/@/utils/http/axios\";\nimport { a as useFormItems, g as getRefPromise, l as loadFormFieldsDefVal } from \"./useAutoForm.js\";\nimport { Loading } from \"/@/components/Loading\";\nimport { _ as _export_sfc } from \"./index.js\";\nimport \"./FormSchemaFactory.js\";\nimport \"/@/components/Form/src/jeecg/components/JUpload\";\nimport \"/@/views/system/user/user.api\";\nimport \"/@/store/modules/user\";\nimport \"/@/utils\";\nimport \"/@/utils/desform/customExpression\";\nimport \"/@/components/Form/src/componentMap\";\nimport \"./OnlineSelectCascade.js\";\nimport \"/@/components/jeecg/OnLine/JPopupOnlReport.vue\";\nimport \"vue-router\";\nconst baseUrl = \"/online/cgform/api/subform\";\nconst _sfc_main = {\n  name: \"OnlineSubForm\",\n  components: {\n    BasicForm,\n    Loading\n  },\n  props: {\n    properties: {\n      type: Object,\n      required: true\n    },\n    mainId: {\n      type: String,\n      default: \"\"\n    },\n    table: {\n      type: String,\n      default: \"\"\n    },\n    formTemplate: {\n      type: Number,\n      default: 1\n    },\n    requiredFields: {\n      type: Array,\n      default: []\n    },\n    isUpdate: {\n      type: Boolean,\n      default: false\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: [\"formChange\"],\n  setup(props, { emit }) {\n    console.log(\"\\u8FDB\\u5165online\\u5B50\\u8868\\u8868\\u5355\\u9875\\u9762\\u300B\\u300B\\u300B\\u300B\" + props.table);\n    const onlineFormRef = ref(null);\n    const formRendered = ref(false);\n    useMessage();\n    const { formSchemas, defaultValueFields, changeDataIfArray2String, tableName, dbData, checkOnlyFieldValue, fieldDisplayStatus, createFormSchemas, baseColProps } = useFormItems(props, onlineFormRef);\n    const [registerForm, { setProps, validate, resetFields, setFieldsValue, getFieldsValue }] = useForm({\n      schemas: formSchemas,\n      showActionButtonGroup: false,\n      baseColProps\n    });\n    watch(() => props.table, () => {\n      tableName.value = props.table;\n    }, { immediate: true });\n    watch(() => props.properties, (valueObj) => {\n      console.log(\"\\u4E3B\\u8868properties\\u6539\\u53D8\", props.properties);\n      formRendered.value = false;\n      addFormChangeEvent();\n      createFormSchemas(props.properties, props.requiredFields, checkOnlyFieldValue);\n      formRendered.value = true;\n    }, { deep: true, immediate: true });\n    watch(() => props.mainId, (valueObj) => {\n      console.log(\"\\u4E3B\\u8868ID\\u6539\\u53D8\", props.mainId);\n      setTimeout(() => {\n        resetSubForm();\n      }, 100);\n    }, { immediate: true });\n    watch(() => props.disabled, (val) => {\n      setProps({ disabled: val });\n    });\n    function addFormChangeEvent() {\n      return __async(this, null, function* () {\n        let formRefObject = yield getRefPromise(onlineFormRef);\n        formRefObject.$formValueChange = (field, value) => {\n          let emitArgument = { [field]: value };\n          emit(\"formChange\", emitArgument);\n        };\n      });\n    }\n    function handleDefaultValue() {\n      if (unref(props.isUpdate) === false) {\n        let fieldProperties = toRaw(defaultValueFields[tableName.value]);\n        loadFormFieldsDefVal(fieldProperties, (values) => {\n          setFieldsValue(values);\n        });\n      }\n    }\n    function resetSubForm() {\n      return __async(this, null, function* () {\n        yield getRefPromise(formRendered);\n        yield resetFields();\n        handleDefaultValue();\n        const { table, mainId } = props;\n        if (!table || !mainId) {\n          return;\n        }\n        let values = yield loadData(table, mainId);\n        dbData.value = values;\n        yield setFieldsValue(values);\n      });\n    }\n    function loadData(table, mainId) {\n      let url = `${baseUrl}/${table}/${mainId}`;\n      return new Promise((resolve, reject) => {\n        defHttp.get({ url }, { isTransformResponse: false }).then((res) => {\n          console.log(res);\n          if (res.success) {\n            resolve(res.result);\n          } else {\n            console.log(res.message);\n            reject();\n          }\n        });\n      }).finally(() => {\n        dbData.value = \"\";\n      });\n    }\n    function getAll() {\n      return new Promise((resolve, reject) => {\n        validate().then(() => {\n          let formData = getFieldsValue();\n          formData = changeDataIfArray2String(formData);\n          resolve(formData);\n        }).catch((e) => {\n          reject(e);\n        });\n      });\n    }\n    function getFormEvent() {\n      let row = getFieldsValue();\n      if (!row.id) {\n        row.id = \"sub-change-temp-id\";\n      }\n      return {\n        row,\n        target: context\n      };\n    }\n    function setValues(values) {\n      setFieldsValue(values);\n    }\n    const context = {\n      onlineFormRef,\n      baseColProps,\n      formSchemas,\n      registerForm,\n      setFieldsValue,\n      getFieldsValue,\n      getFormEvent,\n      setValues,\n      getAll,\n      sh: fieldDisplayStatus\n    };\n    return context;\n  }\n};\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_BasicForm = resolveComponent(\"BasicForm\");\n  return openBlock(), createBlock(_component_BasicForm, {\n    ref: \"onlineFormRef\",\n    onRegister: _ctx.registerForm\n  }, null, 8, [\"onRegister\"]);\n}\nvar OnlineSubForm = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\nexport { OnlineSubForm as default };\n", "import Loading from './src/Loading.vue';\n\nexport { Loading };\nexport { useLoading } from './src/useLoading';\nexport { createLoading } from './src/createLoading';\n", "import { unref } from 'vue';\nimport { createLoading } from './createLoading';\nimport type { LoadingProps } from './typing';\nimport type { Ref } from 'vue';\n\nexport interface UseLoadingOptions {\n  target?: any;\n  props?: Partial<LoadingProps>;\n}\n\ninterface Fn {\n  (): void;\n}\n\nexport function useLoading(props: Partial<LoadingProps>): [Fn, Fn, (string) => void];\nexport function useLoading(opt: Partial<UseLoadingOptions>): [Fn, Fn, (string) => void];\n\nexport function useLoading(opt: Partial<LoadingProps> | Partial<UseLoadingOptions>): [Fn, Fn, (string) => void] {\n  let props: Partial<LoadingProps>;\n  let target: HTMLElement | Ref<ElRef> = document.body;\n\n  if (Reflect.has(opt, 'target') || Reflect.has(opt, 'props')) {\n    const options = opt as Partial<UseLoadingOptions>;\n    props = options.props || {};\n    target = options.target || document.body;\n  } else {\n    props = opt as Partial<LoadingProps>;\n  }\n\n  const instance = createLoading(props, undefined, true);\n\n  const open = (): void => {\n    const t = unref(target as Ref<ElRef>);\n    if (!t) return;\n    instance.open(t);\n  };\n\n  const close = (): void => {\n    instance.close();\n  };\n\n  const setTip = (tip: string) => {\n    instance.setTip(tip);\n  };\n\n  return [open, close, setTip];\n}\n", "import { VNode, defineComponent } from 'vue';\nimport type { LoadingProps } from './typing';\n\nimport { createVNode, render, reactive, h } from 'vue';\nimport Loading from './Loading.vue';\n\nexport function createLoading(props?: Partial<LoadingProps>, target?: HTMLElement, wait = false) {\n  let vm: Nullable<VNode> = null;\n  const data = reactive({\n    tip: '',\n    loading: true,\n    ...props,\n  });\n\n  const LoadingWrap = defineComponent({\n    render() {\n      return h(Loading, { ...data });\n    },\n  });\n\n  vm = createVNode(LoadingWrap);\n\n  if (wait) {\n    // TODO fix https://github.com/anncwb/vue-Jeecg-admin/issues/438\n    setTimeout(() => {\n      render(vm, document.createElement('div'));\n    }, 0);\n  } else {\n    render(vm, document.createElement('div'));\n  }\n\n  function close() {\n    if (vm?.el && vm.el.parentNode) {\n      vm.el.parentNode.removeChild(vm.el);\n    }\n  }\n\n  function open(target: HTMLElement = document.body) {\n    if (!vm || !vm.el) {\n      return;\n    }\n    target.appendChild(vm.el as HTMLElement);\n  }\n\n  if (target) {\n    open(target);\n  }\n  return {\n    vm,\n    close,\n    open,\n    setTip: (tip: string) => {\n      data.tip = tip;\n    },\n    setLoading: (loading: boolean) => {\n      data.loading = loading;\n    },\n    get loading() {\n      return data.loading;\n    },\n    get $el() {\n      return vm?.el as HTMLElement;\n    },\n  };\n}\n"],
  "mappings": "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",
  "names": ["Loading", "Loading"]
}
